@model MangakaApp.Models.PaginationVM

@{
    var pager = Model.Pager;
    var actionName = Model.ActionName ?? "Index";
    var currentSlug = Model.CurrentSlug;
    var currentKeyword = Model.CurrentKeyword;
}

@* --- PHẦN PHÂN TRANG (ĐÃ SỬA LỖI) --- *@
@if (pager != null && pager.TotalPages > 1)
{
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center my-5 pb-5 animate-fade-in" style="animation-delay: 300ms;">


        @* 1. Thống kê *@
        <div class="mb-3 mb-md-0 text-white-50 small">
            <span class="bg-white bg-opacity-10 px-3 py-2 rounded-pill border border-secondary shadow-sm">
                <i class="bi bi-journal-album me-1"></i>
                Trang <span class="fw-bold text-white">@pager.CurrentPage</span>/@pager.TotalPages
                <span class="mx-2 opacity-50">|</span>
                Tổng <span class="fw-bold text-white">@pager.TotalItems</span> Kết quả
            </span>
        </div>

        @* 2. LOGIC TẠO URL (Đã fix null safe) *@
        @{
            string GetPageUrl(int pageNum)
            {
                // Dùng Url.Action để tạo link chuẩn MVC thay vì nối chuỗi thủ công
                return actionName switch
                {
                    "Category" => Url.Action("Category", new { slug = currentSlug, page = pageNum }),
                    "Search" => Url.Action("Search", new { keyword = currentKeyword, page = pageNum }),

                    // Các trang không cần tham số phụ
                    "HotManga" => Url.Action("HotManga", new { page = pageNum }),
                    "ReleasingManga" => Url.Action("ReleasingManga", new { page = pageNum }),
                    "DoneManga" => Url.Action("DoneManga", new { page = pageNum }),
                    "CommingManga" => Url.Action("CommingManga", new { page = pageNum }),

                    // Mặc định về trang chủ
                    _ => Url.Action("Index", new { page = pageNum })
                };
            }
        }

        @* 3. Thanh điều hướng *@
        <nav aria-label="Page navigation">
            <ul class="pagination m-0">

                @* Nút Previous *@
                <li class="page-item @(pager.CurrentPage == 1 ? "disabled" : "")">
                    <a class="page-link bg-dark text-white border-secondary"
                       href="@(pager.CurrentPage == 1 ? "#" : GetPageUrl(pager.CurrentPage - 1))">
                        &laquo;
                    </a>
                </li>

                @* Logic hiển thị số trang (Giữ nguyên) *@
                @if (pager.StartPage > 1)
                {
                    <li class="page-item"><a class="page-link bg-dark text-white border-secondary" href="@GetPageUrl(1)">1</a></li>
                    @if (pager.StartPage > 2)
                    {
                        <li class="page-item disabled"><span class="page-link bg-dark text-white border-secondary">...</span></li>
                    }
                }

                @for (int i = pager.StartPage; i <= pager.EndPage; i++)
                {
                    <li class="page-item @(i == pager.CurrentPage ? "active" : "")">
                        @if (i == pager.CurrentPage)
                        {
                            <span class="page-link bg-primary border-primary text-white shadow">@i</span>
                        }
                        else
                        {
                            <a class="page-link bg-dark text-white border-secondary" href="@GetPageUrl(i)">@i</a>
                        }
                    </li>
                }

                @if (pager.EndPage < pager.TotalPages)
                {
                    @if (pager.EndPage < pager.TotalPages - 1)
                    {
                        <li class="page-item disabled"><span class="page-link bg-dark text-white border-secondary">...</span></li>
                    }
                    <li class="page-item"><a class="page-link bg-dark text-white border-secondary" href="@GetPageUrl(pager.TotalPages)">@pager.TotalPages</a></li>
                }

                @* Nút Next *@
                <li class="page-item @(pager.CurrentPage == pager.TotalPages ? "disabled" : "")">
                    <a class="page-link bg-dark text-white border-secondary"
                       href="@(pager.CurrentPage == pager.TotalPages ? "#" : GetPageUrl(pager.CurrentPage + 1))">
                        &raquo;
                    </a>
                </li>

            </ul>
        </nav>
    </div>
}